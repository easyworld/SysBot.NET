# LZA游戏指针寻找工具实现计划

## 1. 工具概述
创建一个用于查找LZA游戏RAM偏移量的工具，能够连接到运行LZA游戏的Switch，搜索特定数据结构，并生成更新后的偏移量文件。

## 2. 实现步骤

### 2.1 创建工具类
- 在 `SysBot.Pokemon` 项目中创建 `Tools` 目录
- 创建 `PointerFinderLZA` 类，实现指针寻找功能

### 2.2 核心功能实现
- **Switch连接管理**：使用现有 `ISwitchConnectionAsync` 接口连接到Switch
- **内存搜索**：实现基于特定特征的内存搜索功能
- **指针追踪**：从找到的数据反向追踪到稳定的基地址
- **偏移量生成**：将找到的指针路径转换为偏移量格式
- **文件更新**：自动更新 `PokeDataOffsetsLZA.cs` 文件

### 2.3 搜索特征定义
定义LZA游戏中关键数据结构的特征，包括：
- 宝可梦数据特征（大小、标志性字段）
- 玩家状态特征（ID、名称等）
- 交换相关特征（链接代码、伙伴数据等）

### 2.4 命令行界面
创建命令行工具，允许用户：
- 指定Switch IP和端口
- 选择要搜索的数据类型
- 查看搜索结果
- 确认是否更新偏移量文件

### 2.5 集成到项目
- 将工具添加到现有项目结构中
- 更新项目文件以包含新的工具

## 3. 技术细节

### 3.1 内存搜索算法
- 使用滑动窗口搜索特定字节序列
- 支持模糊匹配（忽略某些可变字段）
- 多线程搜索以提高效率

### 3.2 指针追踪策略
- 从找到的数据地址开始，向上搜索指针
- 验证指针的稳定性（多次读取确认）
- 构建完整的指针路径

### 3.3 偏移量格式
- 遵循现有偏移量文件的格式
- 使用 `IReadOnlyList<long>` 存储指针路径
- 包含版本信息和标题ID

## 4. 文件结构
```
SysBot.Pokemon/
├── Tools/
│   └── PointerFinderLZA.cs
├── LZA/
│   └── Vision/
│       └── PokeDataOffsetsLZA.cs
└── Program.cs
```

## 5. 使用方法
1. 在Switch上运行LZA游戏和sys-botbase
2. 运行指针寻找工具
3. 选择要搜索的数据类型
4. 查看搜索结果
5. 确认更新偏移量文件

## 6. 注意事项
- 需要运行LZA游戏的破解Switch
- 需要安装并配置sys-botbase
- 搜索过程中游戏状态应保持稳定
- 更新偏移量后需要重新构建项目

这个工具将帮助开发者快速适应LZA游戏版本更新带来的RAM偏移量变化，确保Kook机器人能够持续支持最新版本的游戏。